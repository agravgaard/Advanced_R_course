---
title: "Notes"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

if (!is.element("advr38pkg", installed.packages()[, 1])){
  if (!is.element("remotes", installed.packages()[, 1])){
    install.packages("remotes")
  }
  library(remotes)
  remotes::install_github("privefl/advr38pkg")
}
```

## Advanced R Course

Use `browser()` to get a gdb-like debugging session.

[rseek.org](rseek.org) is useful to search for R related stuff (as "r" is not the best search term)

```{r, label="Exercise 0"}
m <- matrix(sample(c(TRUE, FALSE), 12, replace = TRUE), 3)
m + 0L
```

```{r, label="Exercise 1"}
sum_adjescent <- function(vec, n_adj){
  l <- length(vec)
  v_out <- c()
  for (i in 0:(l / n_adj)) {
    v_app <- 0
    for (j in 1:n_adj) {
      v_app <- v_app + vec[i * n_adj + j]
    }
    v_out <- c(v_out, v_app)
  }
  v_out
  
}
sum_adjescent(1:10, 2)
```
```{r, label="Solution 1"}
sum_every <- function(x, n) {
  l <- length(x)
  dim(x) <- c(n, l/n)
  colSums(x)
}
sum_every(1:10, 2)
```

## Day 2

```{r label="Exercise 3.4.5"}
# 1
split_rnd_ind <- function(vec, n_groups){
  if (n_groups < 1) {
    return("n_groups should be >=1")
  }
  if (length(vec) < n_groups) {
    return("vec should be at least the lenght of n_groups")
  }
  s_vec <- sample(vec)
  split(s_vec, 1:n_groups)
}

split_rnd_ind(1:40, 3)

# 2
set.seed(1)
rnd_mean <- function(x){
  mean(sample(x, replace=TRUE))
}
x <- rnorm(10)
v_means <- replicate(10e4, rnd_mean(x))

quantile(v_means, probs = c(0.025, 0.975))

# 3
my_mtcars <- mtcars[c("mpg", "hp")]
my_mtcars$my_col <- sample(c("mpg", "hp"),
                           size = nrow(my_mtcars),
                           replace = TRUE)

idx <- match(my_mtcars$my_col, names(my_mtcars))
rc_idx <- cbind(seq_len(nrow(my_mtcars)), idx)
my_mtcars$my_val <- my_mtcars[rc_idx]
head(my_mtcars)

# 4
df <- data.frame(
  id1 = c("a", "f", "a"),
  id2 = c("b", "e", "e"), 
  id3 = c("c", "d", "f"),
  inter = c(7.343, 2.454, 3.234),
  stringsAsFactors = FALSE
)
code <- setNames(1:6, letters[1:6])

df[1:3] <- lapply(df[1:3], function(x) {code[x]})
df
```

Test

```{r label="test"}
test <- function(){
  not_yet_defined_value + 10
}
```

# Day 3

```{r, label="Exercise, ggplot2"}
library(tidyr)
library(ggplot2)

long_data <- iris %>%
  tidyr::pivot_longer(cols = -Species,
                      names_to = "plotvar")

ggplot(long_data, aes(value)) +
  geom_density(aes(fill = Species), alpha = 0.4) +
  facet_wrap( ~ plotvar, scales = "free")
```



```{r, label="Exercise"}
library(gapminder)
library(dplyr)
df <- gapminder::gapminder %>%
  filter(year == 1992)

ggplot(df, aes(
  x = gdpPercap,
  y = lifeExp,
  color = continent,
  size = pop
)) +
  theme_bw() +
  geom_point() +
  scale_x_log10() +
  labs(
    color = "Continent",
    size = "Population",
    x = "Gross Domestic Product (log scale)",
    y = "Life Expectancy at birth (years)",
    title = "Gapminder for 1992"
  )


```

Exercises [from here](https://r4ds.had.co.nz/data-visualisation.html#exercises-1)

```{r, label="Exercises"}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy), color = "blue")
```

```{r, label="ggplot2 Exercise"}
# 2
library(tibble)
tibble(mpg)
# All variables that are int or dbl below is "continuous"


# 3
ggplot(mpg,
       aes(
         x = manufacturer,
         y = class,
         size = displ,
         color = cyl,
         shape = as.factor(year)
       )) + geom_point()
# shape don't do continuous
```


### 4
Nothing special

### 5
" For shapes that have a border (like 21), you can colour the inside and
 outside separately. Use the stroke aesthetic to modify the width of the
 border"
 
```{r, label="ggplot2 Exercises continued"}
# 6
ggplot(mpg,
       aes(x = manufacturer,
           y = class,
           colour = displ < 5)) +
  geom_point()
```

### 3.5.1 Exercises
What happens if you facet on a continuous variable?
```{r}
ggplot(mpg, aes(x=manufacturer, y=class)) +
  geom_point() +
  facet_wrap(~ displ)
```

What do the empty cells in plot with facet_grid(drv ~ cyl) mean? How do they relate to this plot?
```{r}
ggplot(mpg, aes(x=manufacturer, y=class)) +
  geom_point() +
  facet_grid(drv ~ cyl)
```

ggplot(data = mpg) + 
  geom_point(mapping = aes(x = drv, y = cyl))
What plots does the following code make? What does . do?

ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) +
  facet_grid(drv ~ .)

ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) +
  facet_grid(. ~ cyl)
Take the first faceted plot in this section:

ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) + 
  facet_wrap(~ class, nrow = 2)
What are the advantages to using faceting instead of the colour aesthetic? What are the disadvantages? How might the balance change if you had a larger dataset?

Read ?facet_wrap. What does nrow do? What does ncol do? What other options control the layout of the individual panels? Why doesnâ€™t facet_grid() have nrow and ncol arguments?

When using facet_grid() you should usually put the variable with more unique levels in the columns. Why?

